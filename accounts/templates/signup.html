{% extends 'base.html' %}
{% load static %}
{% load crispy_forms_tags %}
{% block content %}

<div class="modal fade" id="form-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" onclick="setProfilePicture()" data-dismiss="modal" aria-hidden="true">&times;</button>
          <h4 class="modal-title">Modal title</h4>
        </div>
        <div id="form-modal-body" class="modal-body">
{#<!--          {% include "webcam.html" %}-->#}

            <table><tr><td valign=top>
	<h1>JPEGCam Test Page</h1>

	<!-- First, include the JPEGCam JavaScript Library -->
	<script type="text/javascript" src="{% static 'media/webcam.js' %}"></script>

	<!-- Configure a few settings -->
	<script language="JavaScript">
		webcam.set_api_url( '/accounts/save_image/' );
		webcam.set_quality( 100 ); // JPEG quality (1 - 100)
		webcam.set_shutter_sound( true ); // play shutter click sound

        function setProfilePicture() {
            document.getElementById('profile-image').value = localStorage.getItem('profile-picture');
        }

	</script>


	<!-- Next, write the movie to the page at 320x240 -->
	<script language="JavaScript">

		// var element = document.getElementById('form-modal-body');

		document.write( webcam.get_html(500, 500) );
		var csrfToken = $('[name="csrfmiddlewaretoken"]').val();
        var data = {'csrfmiddlewaretoken': csrfToken};
        $('#csrf').val(data);
	</script>

	<!-- Some buttons for controlling things -->
	<br/><form>
		<input type=button value="Configure..." onClick="webcam.configure()">
		&nbsp;&nbsp;
		<input type=button value="Take Snapshot" onClick="take_snapshot()">
        <input hidden id="csrf" name="csrf"/>
	</form>

	<!-- Code to handle the server response (see test.php) -->
	<script language="JavaScript">
		webcam.set_hook( 'onComplete', 'my_completion_handler' );

		function take_snapshot() {
			// take snapshot and upload to server
			document.getElementById('upload_results').innerHTML = '<h1>Uploading...</h1>';
			webcam.snap();
		}

		function my_completion_handler(msg) {
			if (msg.match(/(http\:\/\/\S+)/)) {
				var image_url = RegExp.$1;

				localStorage.setItem('profile-picture', image_url);

				// show JPEG image in page
				document.getElementById('upload_results').innerHTML =
					'<h1>Upload Successful!</h1>' +
					'<h3>JPEG URL: ' + image_url + '</h3>' +
					'<img src="' + image_url + '">';

				// reset camera for another shot
				webcam.reset();
			}
			else alert("Python Error: " + msg);
		}
	</script>

	</td><td width=50>&nbsp;</td><td valign=top>
		<div id="upload_results" style="background-color:#eee;"></div>
	</td></tr></table>

       </div>
       <div class="modal-footer">
         <button type="button" onclick="setProfilePicture()" class="btn btn-default" data-dismiss="modal">Close</button>
       </div>
     </div>
   </div>
</div>

    <div class="blackWrap bg">
        <div class="signupBox">
            <img src="{% static 'images/white.png' %}" height="35%" width="35%" alt="logo">
            <p>Sign up for contentuni by filling out the form below:</p>
            <form method="post" class="formWrap" enctype="multipart/form-data">
                {% csrf_token %}
                {{ form.as_p }}
                <button type="submit" class="btn signupBtn">Signup</button>
                <a data-toggle="modal" class="btn btn-primary" href="{% url 'getpage' %}" data-target="#form-modal">Capture Photo</a>
            </form>
        </div>
    </div>

{% endblock %}